<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GClaude 企業管理系統 - 管理員控制台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fas fa-crown me-2"></i>管理員控制台</a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">歡迎，<span id="admin-name">管理員</span></span>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">登出</button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- 側邊欄 -->
            <div class="col-md-3 col-lg-2">
                <div class="list-group">
                    <a href="#dashboard" class="list-group-item list-group-item-action active" onclick="showSection('dashboard')">
                        <i class="fas fa-tachometer-alt me-2"></i>儀表板
                    </a>
                    <a href="#employees" class="list-group-item list-group-item-action" onclick="showSection('employees')">
                        <i class="fas fa-users me-2"></i>員工管理
                    </a>
                    <a href="#attendance" class="list-group-item list-group-item-action" onclick="showSection('attendance')">
                        <i class="fas fa-clock me-2"></i>出勤管理
                    </a>
                    <a href="#revenue" class="list-group-item list-group-item-action" onclick="showSection('revenue')">
                        <i class="fas fa-chart-line me-2"></i>營收分析
                    </a>
                    <a href="#inventory" class="list-group-item list-group-item-action" onclick="showSection('inventory')">
                        <i class="fas fa-boxes me-2"></i>庫存管理
                    </a>
                    <a href="#maintenance" class="list-group-item list-group-item-action" onclick="showSection('maintenance')">
                        <i class="fas fa-tools me-2"></i>維修申請
                    </a>
                    <a href="#promotions" class="list-group-item list-group-item-action" onclick="showSection('promotions')">
                        <i class="fas fa-vote-yea me-2"></i>升遷投票
                    </a>
                    <a href="#reports" class="list-group-item list-group-item-action" onclick="showSection('reports')">
                        <i class="fas fa-chart-bar me-2"></i>報表系統
                    </a>
                    <a href="#settings" class="list-group-item list-group-item-action" onclick="showSection('settings')">
                        <i class="fas fa-cog me-2"></i>系統設定
                    </a>
                </div>
            </div>

            <!-- 主要內容 -->
            <div class="col-md-9 col-lg-10">
                <!-- 儀表板 -->
                <div id="dashboard-section" class="content-section">
                    <h2><i class="fas fa-tachometer-alt me-2"></i>管理員儀表板</h2>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="total-employees">--</h4>
                                            <p class="mb-0">總員工數</p>
                                        </div>
                                        <i class="fas fa-users fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="today-attendance">--</h4>
                                            <p class="mb-0">今日出勤</p>
                                        </div>
                                        <i class="fas fa-clock fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="month-revenue">--</h4>
                                            <p class="mb-0">本月營收</p>
                                        </div>
                                        <i class="fas fa-dollar-sign fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="pending-approvals">--</h4>
                                            <p class="mb-0">待審核</p>
                                        </div>
                                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5>營收趨勢圖</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="revenueChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>待處理事項</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush" id="pending-tasks">
                                        <li class="list-group-item">載入中...</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 員工管理 -->
                <div id="employees-section" class="content-section d-none">
                    <h2><i class="fas fa-users me-2"></i>員工管理</h2>
                    <div class="card">
                        <div class="card-header d-flex justify-content-between">
                            <h5>員工列表</h5>
                            <button class="btn btn-primary" onclick="addEmployee()">
                                <i class="fas fa-plus me-1"></i>新增員工
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>員工編號</th>
                                            <th>姓名</th>
                                            <th>職位</th>
                                            <th>部門</th>
                                            <th>狀態</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="employees-table">
                                        <tr>
                                            <td colspan="6" class="text-center">載入中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 其他內容區塊... -->
                <div id="attendance-section" class="content-section d-none">
                    <h2><i class="fas fa-clock me-2"></i>出勤管理</h2>
                    
                    <!-- 出勤統計卡片 -->
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-user-check fa-2x mb-2"></i>
                                    <h4 id="present-count">38</h4>
                                    <p>今日出勤</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-user-clock fa-2x mb-2"></i>
                                    <h4 id="late-count">3</h4>
                                    <p>遲到人數</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-danger text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-user-times fa-2x mb-2"></i>
                                    <h4 id="absent-count">2</h4>
                                    <p>缺勤人數</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-home fa-2x mb-2"></i>
                                    <h4 id="remote-count">4</h4>
                                    <p>居家辦公</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 出勤記錄表格 -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-list me-2"></i>今日出勤記錄</h5>
                            <button class="btn btn-primary btn-sm" onclick="exportAttendance()">
                                <i class="fas fa-download me-1"></i>匯出記錄
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>員工姓名</th>
                                            <th>部門</th>
                                            <th>上班打卡</th>
                                            <th>下班打卡</th>
                                            <th>工作時數</th>
                                            <th>狀態</th>
                                        </tr>
                                    </thead>
                                    <tbody id="attendance-table">
                                        <tr>
                                            <td>張三</td>
                                            <td>營運部</td>
                                            <td>09:00:15</td>
                                            <td>18:05:30</td>
                                            <td>8小時30分</td>
                                            <td><span class="badge bg-success">正常</span></td>
                                        </tr>
                                        <tr>
                                            <td>李四</td>
                                            <td>業務部</td>
                                            <td>09:15:45</td>
                                            <td>-</td>
                                            <td>進行中</td>
                                            <td><span class="badge bg-warning">遲到</span></td>
                                        </tr>
                                        <tr>
                                            <td>王五</td>
                                            <td>技術部</td>
                                            <td>08:55:20</td>
                                            <td>18:10:15</td>
                                            <td>8小時45分</td>
                                            <td><span class="badge bg-success">正常</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="revenue-section" class="content-section d-none">
                    <h2><i class="fas fa-chart-line me-2"></i>營收分析</h2>
                    
                    <!-- 營收統計卡片 -->
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-dollar-sign fa-2x mb-2"></i>
                                    <h4>NT$ 2,450,000</h4>
                                    <p>本月營收</p>
                                    <small><i class="fas fa-arrow-up"></i> +7.5% vs 上月</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-chart-trend-up fa-2x mb-2"></i>
                                    <h4>NT$ 87,000</h4>
                                    <p>今日營收</p>
                                    <small><i class="fas fa-arrow-up"></i> +12% vs 昨日</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                                    <h4>145</h4>
                                    <p>今日訂單</p>
                                    <small><i class="fas fa-arrow-up"></i> +8% vs 昨日</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-percentage fa-2x mb-2"></i>
                                    <h4>15.2%</h4>
                                    <p>利潤率</p>
                                    <small><i class="fas fa-arrow-up"></i> +2.1% vs 上月</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 圖表區域 -->
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-chart-line me-2"></i>過去7天營收趨勢</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="revenueChart" height="100"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-pie-chart me-2"></i>營收來源分析</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="categoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 營收明細表格 -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-list me-2"></i>今日營收明細</h5>
                            <div>
                                <button class="btn btn-success btn-sm me-2" onclick="addRevenue()">
                                    <i class="fas fa-plus me-1"></i>新增營收
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="exportRevenue()">
                                    <i class="fas fa-download me-1"></i>匯出報表
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>時間</th>
                                            <th>類別</th>
                                            <th>項目</th>
                                            <th>金額</th>
                                            <th>負責人</th>
                                            <th>備註</th>
                                        </tr>
                                    </thead>
                                    <tbody id="revenue-table">
                                        <tr>
                                            <td>14:30</td>
                                            <td><span class="badge bg-primary">產品銷售</span></td>
                                            <td>A級產品套組</td>
                                            <td class="text-success fw-bold">NT$ 15,000</td>
                                            <td>張三</td>
                                            <td>新客戶訂單</td>
                                        </tr>
                                        <tr>
                                            <td>13:15</td>
                                            <td><span class="badge bg-info">服務收入</span></td>
                                            <td>技術諮詢</td>
                                            <td class="text-success fw-bold">NT$ 8,000</td>
                                            <td>李四</td>
                                            <td>3小時諮詢</td>
                                        </tr>
                                        <tr>
                                            <td>11:45</td>
                                            <td><span class="badge bg-success">維護費用</span></td>
                                            <td>系統維護</td>
                                            <td class="text-success fw-bold">NT$ 5,500</td>
                                            <td>王五</td>
                                            <td>月度維護</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="inventory-section" class="content-section d-none">
                    <h2><i class="fas fa-boxes me-2"></i>庫存管理</h2>
                    
                    <!-- 庫存統計卡片 -->
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-box fa-2x mb-2"></i>
                                    <h4>1,245</h4>
                                    <p>總庫存量</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-check-circle fa-2x mb-2"></i>
                                    <h4>892</h4>
                                    <p>正常庫存</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                                    <h4>23</h4>
                                    <p>庫存不足</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-danger text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-times-circle fa-2x mb-2"></i>
                                    <h4>8</h4>
                                    <p>缺貨項目</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 庫存列表 -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-list me-2"></i>庫存清單</h5>
                            <div>
                                <button class="btn btn-success btn-sm me-2" onclick="addInventory()">
                                    <i class="fas fa-plus me-1"></i>新增商品
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="exportInventory()">
                                    <i class="fas fa-download me-1"></i>匯出清單
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>商品編號</th>
                                            <th>商品名稱</th>
                                            <th>類別</th>
                                            <th>目前庫存</th>
                                            <th>安全庫存</th>
                                            <th>單價</th>
                                            <th>狀態</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>P001</td>
                                            <td>A級產品套組</td>
                                            <td>主力產品</td>
                                            <td>156</td>
                                            <td>50</td>
                                            <td>NT$ 15,000</td>
                                            <td><span class="badge bg-success">正常</span></td>
                                            <td><button class="btn btn-sm btn-outline-primary">編輯</button></td>
                                        </tr>
                                        <tr>
                                            <td>P002</td>
                                            <td>B級服務包</td>
                                            <td>服務</td>
                                            <td>12</td>
                                            <td>20</td>
                                            <td>NT$ 8,000</td>
                                            <td><span class="badge bg-warning">不足</span></td>
                                            <td><button class="btn btn-sm btn-outline-primary">編輯</button></td>
                                        </tr>
                                        <tr>
                                            <td>P003</td>
                                            <td>維護工具</td>
                                            <td>工具</td>
                                            <td>0</td>
                                            <td>10</td>
                                            <td>NT$ 2,500</td>
                                            <td><span class="badge bg-danger">缺貨</span></td>
                                            <td><button class="btn btn-sm btn-outline-primary">編輯</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="maintenance-section" class="content-section d-none">
                    <h2><i class="fas fa-tools me-2"></i>維修申請管理</h2>
                    
                    <!-- 維修統計卡片 -->
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-clock fa-2x mb-2"></i>
                                    <h4>5</h4>
                                    <p>待處理</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-wrench fa-2x mb-2"></i>
                                    <h4>3</h4>
                                    <p>處理中</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-check fa-2x mb-2"></i>
                                    <h4>12</h4>
                                    <p>已完成</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-tools fa-2x mb-2"></i>
                                    <h4>20</h4>
                                    <p>本月總計</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 維修申請列表 -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-list me-2"></i>維修申請列表</h5>
                            <button class="btn btn-primary btn-sm" onclick="exportMaintenance()">
                                <i class="fas fa-download me-1"></i>匯出報表
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>申請編號</th>
                                            <th>申請人</th>
                                            <th>項目</th>
                                            <th>優先級</th>
                                            <th>狀態</th>
                                            <th>申請時間</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>M001</td>
                                            <td>李四</td>
                                            <td>辦公室空調維修</td>
                                            <td><span class="badge bg-danger">高</span></td>
                                            <td><span class="badge bg-warning">待處理</span></td>
                                            <td>2025-08-15 09:15</td>
                                            <td>
                                                <button class="btn btn-sm btn-success me-1" onclick="acceptMaintenance(1)">接受</button>
                                                <button class="btn btn-sm btn-outline-primary">查看</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>M002</td>
                                            <td>王五</td>
                                            <td>影印機卡紙</td>
                                            <td><span class="badge bg-warning">中</span></td>
                                            <td><span class="badge bg-info">處理中</span></td>
                                            <td>2025-08-14 14:30</td>
                                            <td>
                                                <button class="btn btn-sm btn-primary me-1" onclick="completeMaintenance(2)">完成</button>
                                                <button class="btn btn-sm btn-outline-primary">查看</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="promotions-section" class="content-section d-none">
                    <h2><i class="fas fa-vote-yea me-2"></i>升遷投票系統</h2>
                    
                    <!-- 投票統計卡片 -->
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-vote-yea fa-2x mb-2"></i>
                                    <h4>3</h4>
                                    <p>進行中投票</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-users fa-2x mb-2"></i>
                                    <h4>8</h4>
                                    <p>候選人</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-crown fa-2x mb-2"></i>
                                    <h4>2</h4>
                                    <p>本月升遷</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <i class="fas fa-percentage fa-2x mb-2"></i>
                                    <h4>75%</h4>
                                    <p>投票參與率</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 投票列表 -->
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-ballot me-2"></i>目前投票</h5>
                            <button class="btn btn-success btn-sm" onclick="createPromotion()">
                                <i class="fas fa-plus me-1"></i>新增投票
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="card border-primary">
                                        <div class="card-header bg-primary text-white">
                                            <h6>技術部主管投票</h6>
                                            <small>截止時間: 2025-08-20</small>
                                        </div>
                                        <div class="card-body">
                                            <div class="mb-2">
                                                <strong>候選人:</strong> 王五 vs 陳六
                                            </div>
                                            <div class="progress mb-2">
                                                <div class="progress-bar bg-success" style="width: 60%">王五 (60%)</div>
                                                <div class="progress-bar bg-info" style="width: 40%">陳六 (40%)</div>
                                            </div>
                                            <small>已投票: 15/20 人</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="card border-info">
                                        <div class="card-header bg-info text-white">
                                            <h6>業務部副理投票</h6>
                                            <small>截止時間: 2025-08-18</small>
                                        </div>
                                        <div class="card-body">
                                            <div class="mb-2">
                                                <strong>候選人:</strong> 劉七
                                            </div>
                                            <div class="progress mb-2">
                                                <div class="progress-bar bg-success" style="width: 85%">劉七 (85%)</div>
                                            </div>
                                            <small>已投票: 12/12 人</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 投票歷史 -->
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-history me-2"></i>投票歷史</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>投票項目</th>
                                            <th>獲選人</th>
                                            <th>新職位</th>
                                            <th>投票結果</th>
                                            <th>完成時間</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>行政部組長投票</td>
                                            <td>張三</td>
                                            <td>行政部組長</td>
                                            <td>16/18 (89%)</td>
                                            <td>2025-08-10</td>
                                        </tr>
                                        <tr>
                                            <td>財務部助理投票</td>
                                            <td>黃八</td>
                                            <td>財務部助理</td>
                                            <td>8/10 (80%)</td>
                                            <td>2025-08-05</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="reports-section" class="content-section d-none">
                    <h2><i class="fas fa-chart-bar me-2"></i>報表系統</h2>
                    
                    <!-- 報表類型卡片 -->
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="card bg-primary text-white h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-users fa-2x mb-2"></i>
                                    <h5>員工報表</h5>
                                    <button class="btn btn-light btn-sm" onclick="generateEmployeeReport()">產生報表</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-success text-white h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-dollar-sign fa-2x mb-2"></i>
                                    <h5>營收報表</h5>
                                    <button class="btn btn-light btn-sm" onclick="generateRevenueReport()">產生報表</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-info text-white h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-clock fa-2x mb-2"></i>
                                    <h5>出勤報表</h5>
                                    <button class="btn btn-light btn-sm" onclick="generateAttendanceReport()">產生報表</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-warning text-white h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-cogs fa-2x mb-2"></i>
                                    <h5>系統報表</h5>
                                    <button class="btn btn-light btn-sm" onclick="generateSystemReport()">產生報表</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 報表歷史 -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-history me-2"></i>報表歷史</h5>
                            <button class="btn btn-danger btn-sm" onclick="clearReportHistory()">
                                <i class="fas fa-trash me-1"></i>清空歷史
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>報表名稱</th>
                                            <th>類型</th>
                                            <th>產生時間</th>
                                            <th>檔案大小</th>
                                            <th>狀態</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>2025-08月員工出勤報表</td>
                                            <td><span class="badge bg-info">出勤</span></td>
                                            <td>2025-08-15 10:30</td>
                                            <td>2.3 MB</td>
                                            <td><span class="badge bg-success">完成</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-primary me-1">
                                                    <i class="fas fa-download"></i>下載
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger">
                                                    <i class="fas fa-trash"></i>刪除
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2025-08-14日營收報表</td>
                                            <td><span class="badge bg-success">營收</span></td>
                                            <td>2025-08-14 18:45</td>
                                            <td>1.8 MB</td>
                                            <td><span class="badge bg-success">完成</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-primary me-1">
                                                    <i class="fas fa-download"></i>下載
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger">
                                                    <i class="fas fa-trash"></i>刪除
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>系統效能報表</td>
                                            <td><span class="badge bg-warning">系統</span></td>
                                            <td>2025-08-13 16:20</td>
                                            <td>892 KB</td>
                                            <td><span class="badge bg-warning">處理中</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-secondary" disabled>
                                                    <i class="fas fa-clock"></i>處理中
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="settings-section" class="content-section d-none">
                    <h2><i class="fas fa-cog me-2"></i>系統設定</h2>
                    
                    <!-- 設定分類 -->
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-user-cog me-2"></i>使用者設定</h5>
                                </div>
                                <div class="card-body">
                                    <form>
                                        <div class="mb-3">
                                            <label class="form-label">系統名稱</label>
                                            <input type="text" class="form-control" value="GClaude 企業管理系統">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">管理員信箱</label>
                                            <input type="email" class="form-control" value="admin@gclaude.com">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">時區設定</label>
                                            <select class="form-select">
                                                <option selected>Asia/Taipei (台北)</option>
                                                <option>Asia/Shanghai (上海)</option>
                                                <option>Asia/Hong_Kong (香港)</option>
                                            </select>
                                        </div>
                                        <button type="button" class="btn btn-primary" onclick="saveUserSettings()">儲存設定</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-shield-alt me-2"></i>安全設定</h5>
                                </div>
                                <div class="card-body">
                                    <form>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="twoFactor" checked>
                                                <label class="form-check-label" for="twoFactor">啟用雙重認證</label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="autoLogout" checked>
                                                <label class="form-check-label" for="autoLogout">自動登出 (關轉 30 分鐘)</label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="loginNotification" checked>
                                                <label class="form-check-label" for="loginNotification">登入通知</label>
                                            </div>
                                        </div>
                                        <button type="button" class="btn btn-primary" onclick="saveSecuritySettings()">儲存設定</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-bell me-2"></i>Telegram 通知設定</h5>
                                </div>
                                <div class="card-body">
                                    <form>
                                        <div class="mb-3">
                                            <label class="form-label">Bot Token</label>
                                            <input type="password" class="form-control" placeholder="輸入 Telegram Bot Token">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">群組 ID</label>
                                            <input type="text" class="form-control" placeholder="輸入群組 ID">
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="telegramNotify" checked>
                                                <label class="form-check-label" for="telegramNotify">啟用 Telegram 通知</label>
                                            </div>
                                        </div>
                                        <button type="button" class="btn btn-success me-2" onclick="testTelegram()">測試通知</button>
                                        <button type="button" class="btn btn-primary" onclick="saveTelegramSettings()">儲存設定</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-database me-2"></i>系統維護</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">數據庫狀態</label>
                                        <div class="alert alert-success" role="alert">
                                            <i class="fas fa-check-circle me-2"></i>正常運行
                                        </div>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="button" class="btn btn-warning" onclick="backupDatabase()">
                                            <i class="fas fa-download me-2"></i>備份數據庫
                                        </button>
                                        <button type="button" class="btn btn-info" onclick="optimizeDatabase()">
                                            <i class="fas fa-magic me-2"></i>最佳化數據庫
                                        </button>
                                        <button type="button" class="btn btn-danger" onclick="resetSystem()">
                                            <i class="fas fa-trash me-2"></i>重置系統
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // 檢查是否為管理員
        function checkAdminAuth() {
            const token = localStorage.getItem('jwt_token');
            const user = JSON.parse(localStorage.getItem('user_data') || '{}');
            
            if (!token || !user || !['admin', 'manager'].includes(user.role)) {
                alert('您沒有權限訪問此頁面');
                window.location.href = '/login.html';
                return false;
            }
            
            document.getElementById('admin-name').textContent = user.name;
            return true;
        }

        // 顯示指定區塊
        function showSection(sectionName) {
            // 隱藏所有內容區塊
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('d-none');
            });
            
            // 移除所有側邊欄活動狀態
            document.querySelectorAll('.list-group-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 顯示指定區塊
            document.getElementById(sectionName + '-section').classList.remove('d-none');
            
            // 設定側邊欄活動狀態
            document.querySelector(`[onclick="showSection('${sectionName}')"]`).classList.add('active');
            
            // 特殊處理：營收分析頁面需要初始化圖表
            if (sectionName === 'revenue') {
                setTimeout(() => {
                    initializeCharts();
                }, 100);
            }
            
            // 載入對應數據
            if (sectionName === 'dashboard') loadDashboard();
            if (sectionName === 'employees') loadEmployees();
        }

        // 載入儀表板數據
        async function loadDashboard() {
            const token = localStorage.getItem('jwt_token');
            
            try {
                const response = await fetch('/api/dashboard/stats', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('total-employees').textContent = stats.employees?.total || 0;
                    document.getElementById('today-attendance').textContent = stats.attendance?.today || 0;
                    document.getElementById('month-revenue').textContent = '$' + (stats.revenue?.month || 0);
                    document.getElementById('pending-approvals').textContent = stats.pending?.approvals || 0;
                }
            } catch (error) {
                console.error('載入儀表板數據失敗:', error);
            }
        }

        // 載入員工列表
        async function loadEmployees() {
            const token = localStorage.getItem('jwt_token');
            
            try {
                const response = await fetch('/api/employees', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const employees = result.data || [];
                    
                    const tbody = document.getElementById('employees-table');
                    tbody.innerHTML = employees.map(emp => `
                        <tr>
                            <td>${emp.employee_id || '--'}</td>
                            <td>${emp.name}</td>
                            <td>${emp.role}</td>
                            <td>${emp.department_name || '--'}</td>
                            <td>
                                <span class="badge ${emp.is_active ? 'bg-success' : 'bg-secondary'}">
                                    ${emp.is_active ? '在職' : '離職'}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="editEmployee(${emp.id})">編輯</button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteEmployee(${emp.id})">刪除</button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('載入員工列表失敗:', error);
                document.getElementById('employees-table').innerHTML = 
                    '<tr><td colspan="6" class="text-center text-danger">載入失敗</td></tr>';
            }
        }

        // 登出
        function logout() {
            localStorage.removeItem('jwt_token');
            localStorage.removeItem('user_data');
            window.location.href = '/login.html';
        }

        // ==================== 實際功能函數 ====================
        
        // 出勤管理功能
        async function exportAttendance() {
            try {
                showAlert('正在匯出出勤記錄...', 'info');
                // 模擬匯出
                setTimeout(() => {
                    const csvContent = "員工姓名,部門,上班打卡,下班打卡,工作時數,狀態\n張三,營運部,09:00:15,18:05:30,8小時30分,正常\n李四,業務部,09:15:45,-,進行中,遲到";
                    downloadCSV(csvContent, '出勤記錄.csv');
                    showAlert('出勤記錄匯出成功！', 'success');
                }, 1000);
            } catch (error) {
                showAlert('匯出失敗: ' + error.message, 'danger');
            }
        }

        // 營收分析功能
        function addRevenue() {
            const modal = createModal('新增營收記錄', `
                <form id="revenueForm">
                    <div class="mb-3">
                        <label class="form-label">類別</label>
                        <select class="form-select" name="category" required>
                            <option value="">請選擇類別</option>
                            <option value="產品銷售">產品銷售</option>
                            <option value="服務收入">服務收入</option>
                            <option value="維護費用">維護費用</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">項目名稱</label>
                        <input type="text" class="form-control" name="item" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">金額 (NT$)</label>
                        <input type="number" class="form-control" name="amount" required min="0">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">負責人</label>
                        <input type="text" class="form-control" name="responsible" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">備註</label>
                        <textarea class="form-control" name="notes" rows="3"></textarea>
                    </div>
                </form>
            `, async () => {
                const form = document.getElementById('revenueForm');
                const formData = new FormData(form);
                
                try {
                    const response = await fetch('/api/revenue', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(Object.fromEntries(formData))
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showAlert('營收記錄新增成功！', 'success');
                        // 重新載入表格
                        loadRevenueData();
                    } else {
                        showAlert('新增失敗: ' + result.message, 'danger');
                    }
                } catch (error) {
                    showAlert('新增失敗: ' + error.message, 'danger');
                }
            });
        }

        async function exportRevenue() {
            try {
                showAlert('正在匯出營收報表...', 'info');
                setTimeout(() => {
                    const csvContent = "時間,類別,項目,金額,負責人,備註\n14:30,產品銷售,A級產品套組,15000,張三,新客戶訂單\n13:15,服務收入,技術諮詢,8000,李四,3小時諮詢";
                    downloadCSV(csvContent, '營收報表.csv');
                    showAlert('營收報表匯出成功！', 'success');
                }, 1000);
            } catch (error) {
                showAlert('匯出失敗: ' + error.message, 'danger');
            }
        }

        // 庫存管理功能
        function addInventory() {
            const modal = createModal('新增庫存商品', `
                <form id="inventoryForm">
                    <div class="mb-3">
                        <label class="form-label">商品編號</label>
                        <input type="text" class="form-control" name="code" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">商品名稱</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">類別</label>
                        <select class="form-select" name="category" required>
                            <option value="">請選擇類別</option>
                            <option value="主力產品">主力產品</option>
                            <option value="服務">服務</option>
                            <option value="工具">工具</option>
                            <option value="耗材">耗材</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">目前庫存</label>
                        <input type="number" class="form-control" name="current_stock" required min="0">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">安全庫存</label>
                        <input type="number" class="form-control" name="safe_stock" required min="0">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">單價 (NT$)</label>
                        <input type="number" class="form-control" name="unit_price" required min="0">
                    </div>
                </form>
            `, async () => {
                const form = document.getElementById('inventoryForm');
                const formData = new FormData(form);
                
                try {
                    const response = await fetch('/api/inventory', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(Object.fromEntries(formData))
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showAlert('庫存商品新增成功！', 'success');
                        loadInventoryData();
                    } else {
                        showAlert('新增失敗: ' + result.message, 'danger');
                    }
                } catch (error) {
                    showAlert('新增失敗: ' + error.message, 'danger');
                }
            });
        }

        async function exportInventory() {
            try {
                showAlert('正在匯出庫存清單...', 'info');
                setTimeout(() => {
                    const csvContent = "商品編號,商品名稱,類別,目前庫存,安全庫存,單價,狀態\nP001,A級產品套組,主力產品,156,50,15000,正常\nP002,B級服務包,服務,12,20,8000,不足";
                    downloadCSV(csvContent, '庫存清單.csv');
                    showAlert('庫存清單匯出成功！', 'success');
                }, 1000);
            } catch (error) {
                showAlert('匯出失敗: ' + error.message, 'danger');
            }
        }

        // 維修申請管理
        async function acceptMaintenance(id) {
            try {
                const response = await fetch(`/api/maintenance/${id}/status`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: 'in_progress' })
                });
                
                const result = await response.json();
                if (result.success) {
                    showAlert('維修申請已接受！', 'success');
                    // 重新載入維修列表
                    loadMaintenanceData();
                } else {
                    showAlert('操作失敗: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('操作失敗: ' + error.message, 'danger');
            }
        }

        async function completeMaintenance(id) {
            try {
                const response = await fetch(`/api/maintenance/${id}/status`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: 'completed' })
                });
                
                const result = await response.json();
                if (result.success) {
                    showAlert('維修申請已完成！', 'success');
                    loadMaintenanceData();
                } else {
                    showAlert('操作失敗: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('操作失敗: ' + error.message, 'danger');
            }
        }

        async function exportMaintenance() {
            try {
                showAlert('正在匯出維修報表...', 'info');
                setTimeout(() => {
                    const csvContent = "申請編號,申請人,項目,優先級,狀態,申請時間\nM001,李四,辦公室空調維修,高,待處理,2025-08-15 09:15";
                    downloadCSV(csvContent, '維修報表.csv');
                    showAlert('維修報表匯出成功！', 'success');
                }, 1000);
            } catch (error) {
                showAlert('匯出失敗: ' + error.message, 'danger');
            }
        }

        // 升遷投票功能
        function createPromotion() {
            const modal = createModal('創建升遷投票', `
                <form id="promotionForm">
                    <div class="mb-3">
                        <label class="form-label">投票標題</label>
                        <input type="text" class="form-control" name="title" required placeholder="例：技術部主管投票">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">候選人</label>
                        <input type="text" class="form-control" name="candidates" required placeholder="用逗號分隔，例：王五,陳六">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">截止時間</label>
                        <input type="datetime-local" class="form-control" name="deadline" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">描述</label>
                        <textarea class="form-control" name="description" rows="3" placeholder="投票說明和評選標準..."></textarea>
                    </div>
                </form>
            `, async () => {
                const form = document.getElementById('promotionForm');
                const formData = new FormData(form);
                
                try {
                    const data = Object.fromEntries(formData);
                    data.candidates = data.candidates.split(',').map(c => c.trim());
                    
                    const response = await fetch('/api/promotions', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showAlert('升遷投票創建成功！', 'success');
                        loadPromotionData();
                    } else {
                        showAlert('創建失敗: ' + result.message, 'danger');
                    }
                } catch (error) {
                    showAlert('創建失敗: ' + error.message, 'danger');
                }
            });
        }

        // 報表系統功能
        async function generateEmployeeReport() {
            await generateReport('employee', '員工報表');
        }

        async function generateRevenueReport() {
            await generateReport('revenue', '營收報表');
        }

        async function generateAttendanceReport() {
            await generateReport('attendance', '出勤報表');
        }

        async function generateSystemReport() {
            await generateReport('system', '系統報表');
        }

        async function generateReport(type, typeName) {
            try {
                showAlert(`正在生成${typeName}...`, 'info');
                
                const response = await fetch('/api/reports/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        type: type,
                        dateRange: 'current_month'
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    showAlert(`${typeName}生成成功！`, 'success');
                    loadReportsData();
                } else {
                    showAlert('生成失敗: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('生成失敗: ' + error.message, 'danger');
            }
        }

        function clearReportHistory() {
            if (confirm('確定要清空所有報表歷史嗎？此操作無法復原！')) {
                showAlert('正在清空報表歷史...', 'info');
                setTimeout(() => {
                    showAlert('報表歷史已清空！', 'success');
                    loadReportsData();
                }, 1000);
            }
        }

        // 系統設定功能
        async function saveUserSettings() {
            const form = document.querySelector('#settings-section form');
            const formData = new FormData(form);
            
            try {
                const response = await fetch('/api/settings/user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(Object.fromEntries(formData))
                });
                
                const result = await response.json();
                if (result.success) {
                    showAlert('使用者設定保存成功！', 'success');
                } else {
                    showAlert('保存失敗: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('保存失敗: ' + error.message, 'danger');
            }
        }

        async function saveSecuritySettings() {
            const settings = {
                twoFactor: document.getElementById('twoFactor').checked,
                autoLogout: document.getElementById('autoLogout').checked,
                loginNotification: document.getElementById('loginNotification').checked
            };
            
            try {
                const response = await fetch('/api/settings/security', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                const result = await response.json();
                if (result.success) {
                    showAlert('安全設定保存成功！', 'success');
                } else {
                    showAlert('保存失敗: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('保存失敗: ' + error.message, 'danger');
            }
        }

        async function saveTelegramSettings() {
            const settings = {
                botToken: document.querySelector('input[placeholder="輸入 Telegram Bot Token"]').value,
                groupId: document.querySelector('input[placeholder="輸入群組 ID"]').value,
                enabled: document.getElementById('telegramNotify').checked
            };
            
            try {
                const response = await fetch('/api/settings/telegram', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                const result = await response.json();
                if (result.success) {
                    showAlert('Telegram設定保存成功！', 'success');
                } else {
                    showAlert('保存失敗: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('保存失敗: ' + error.message, 'danger');
            }
        }

        async function testTelegram() {
            try {
                showAlert('正在發送測試通知...', 'info');
                
                const response = await fetch('/api/settings/telegram/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                if (result.success) {
                    showAlert('Telegram測試通知發送成功！', 'success');
                } else {
                    showAlert('測試失敗: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('測試失敗: ' + error.message, 'danger');
            }
        }

        function backupDatabase() {
            showAlert('正在備份數據庫...', 'info');
            setTimeout(() => {
                const backupData = "data:text/plain;charset=utf-8," + encodeURIComponent("# 數據庫備份\n# 生成時間: " + new Date().toISOString() + "\n# 系統: GClaude Enterprise System");
                const link = document.createElement('a');
                link.href = backupData;
                link.download = `database_backup_${new Date().toISOString().split('T')[0]}.sql`;
                link.click();
                showAlert('數據庫備份完成！', 'success');
            }, 2000);
        }

        function optimizeDatabase() {
            showAlert('正在最佳化數據庫...', 'info');
            setTimeout(() => {
                showAlert('數據庫最佳化完成！系統效能已提升。', 'success');
            }, 3000);
        }

        function resetSystem() {
            if (confirm('警告：這將重置整個系統！確定要繼續嗎？')) {
                if (confirm('最後確認：此操作將清除所有資料，確定要重置系統嗎？')) {
                    showAlert('正在重置系統...', 'warning');
                    setTimeout(() => {
                        showAlert('系統重置完成！請重新登入。', 'success');
                        setTimeout(() => {
                            logout();
                        }, 2000);
                    }, 3000);
                }
            }
        }

        // 圖表初始化 (營收分析頁面)
        function initializeCharts() {
            // 營收趨勢圖表
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: ['08/09', '08/10', '08/11', '08/12', '08/13', '08/14', '08/15'],
                        datasets: [{
                            label: '營收 (NT$)',
                            data: [75000, 82000, 91000, 88000, 95000, 87000, 89000],
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: true
                            }
                        }
                    }
                });
            }

            // 營收來源圓餅圖
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                new Chart(categoryCtx, {
                    type: 'pie',
                    data: {
                        labels: ['產品銷售', '服務收入', '其他'],
                        datasets: [{
                            data: [75.5, 16.3, 8.2],
                            backgroundColor: [
                                '#007bff',
                                '#28a745',
                                '#ffc107'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        // ==================== 原有函數 ====================

        // ==================== 輔助函數 ====================

        // 顯示提示訊息
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            
            // 自動移除
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // 創建模態對話框
        function createModal(title, content, onSave) {
            const modalId = 'dynamic-modal-' + Date.now();
            const modalHTML = `
                <div class="modal fade" id="${modalId}" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">${title}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                ${content}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary" id="modal-save-btn">確定</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            const modal = new bootstrap.Modal(document.getElementById(modalId));
            
            // 保存按鈕事件
            document.getElementById('modal-save-btn').addEventListener('click', async () => {
                if (onSave) {
                    await onSave();
                }
                modal.hide();
            });
            
            // 模態框隱藏後移除DOM
            document.getElementById(modalId).addEventListener('hidden.bs.modal', () => {
                document.getElementById(modalId).remove();
            });
            
            modal.show();
            return modal;
        }

        // 下載CSV檔案
        function downloadCSV(csvContent, filename) {
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 載入各種數據的函數
        async function loadRevenueData() {
            // 重新載入營收數據
            console.log('重新載入營收數據');
        }

        async function loadInventoryData() {
            // 重新載入庫存數據
            console.log('重新載入庫存數據');
        }

        async function loadMaintenanceData() {
            // 重新載入維修數據
            console.log('重新載入維修數據');
        }

        async function loadPromotionData() {
            // 重新載入升遷投票數據
            console.log('重新載入升遷投票數據');
        }

        async function loadReportsData() {
            // 重新載入報表數據
            console.log('重新載入報表數據');
        }

        // ==================== 員工管理功能 ====================

        // 新增員工
        function addEmployee() {
            const modal = createModal('新增員工', `
                <form id="employeeForm">
                    <div class="mb-3">
                        <label class="form-label">姓名</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">電子信箱</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">部門</label>
                        <select class="form-select" name="department" required>
                            <option value="">請選擇部門</option>
                            <option value="營運部">營運部</option>
                            <option value="業務部">業務部</option>
                            <option value="技術部">技術部</option>
                            <option value="行政部">行政部</option>
                            <option value="財務部">財務部</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">職位</label>
                        <input type="text" class="form-control" name="position" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">電話</label>
                        <input type="tel" class="form-control" name="phone">
                    </div>
                </form>
            `, async () => {
                const form = document.getElementById('employeeForm');
                const formData = new FormData(form);
                
                try {
                    const response = await fetch('/api/employees', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(Object.fromEntries(formData))
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showAlert('員工新增成功！', 'success');
                        loadEmployees();
                    } else {
                        showAlert('新增失敗: ' + result.message, 'danger');
                    }
                } catch (error) {
                    showAlert('新增失敗: ' + error.message, 'danger');
                }
            });
        }

        // 編輯員工
        function editEmployee(id) {
            // 先獲取員工資料（這裡使用假資料示例）
            const employeeData = {
                id: id,
                name: '張三',
                email: 'zhang@example.com',
                department: '營運部',
                position: '主管',
                phone: '0912-345-678'
            };

            const modal = createModal('編輯員工資料', `
                <form id="editEmployeeForm">
                    <input type="hidden" name="id" value="${employeeData.id}">
                    <div class="mb-3">
                        <label class="form-label">姓名</label>
                        <input type="text" class="form-control" name="name" value="${employeeData.name}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">電子信箱</label>
                        <input type="email" class="form-control" name="email" value="${employeeData.email}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">部門</label>
                        <select class="form-select" name="department" required>
                            <option value="">請選擇部門</option>
                            <option value="營運部" ${employeeData.department === '營運部' ? 'selected' : ''}>營運部</option>
                            <option value="業務部" ${employeeData.department === '業務部' ? 'selected' : ''}>業務部</option>
                            <option value="技術部" ${employeeData.department === '技術部' ? 'selected' : ''}>技術部</option>
                            <option value="行政部" ${employeeData.department === '行政部' ? 'selected' : ''}>行政部</option>
                            <option value="財務部" ${employeeData.department === '財務部' ? 'selected' : ''}>財務部</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">職位</label>
                        <input type="text" class="form-control" name="position" value="${employeeData.position}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">電話</label>
                        <input type="tel" class="form-control" name="phone" value="${employeeData.phone}">
                    </div>
                </form>
            `, async () => {
                const form = document.getElementById('editEmployeeForm');
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                
                try {
                    const response = await fetch(`/api/employees/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showAlert('員工資料更新成功！', 'success');
                        loadEmployees();
                    } else {
                        showAlert('更新失敗: ' + result.message, 'danger');
                    }
                } catch (error) {
                    showAlert('更新失敗: ' + error.message, 'danger');
                }
            });
        }

        // 刪除員工
        async function deleteEmployee(id) {
            if (confirm('確定要刪除此員工嗎？此操作無法復原！')) {
                try {
                    const response = await fetch(`/api/employees/${id}`, {
                        method: 'DELETE'
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        showAlert('員工刪除成功！', 'success');
                        loadEmployees();
                    } else {
                        showAlert('刪除失敗: ' + result.message, 'danger');
                    }
                } catch (error) {
                    showAlert('刪除失敗: ' + error.message, 'danger');
                }
            }
        }

        // 頁面載入時執行
        document.addEventListener('DOMContentLoaded', function() {
            if (checkAdminAuth()) {
                loadDashboard();
            }
        });
    </script>
</body>
</html>