<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GClaude 企業管理系統 - 管理員控制台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fas fa-crown me-2"></i>管理員控制台</a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">歡迎，<span id="admin-name">管理員</span></span>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">登出</button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- 側邊欄 -->
            <div class="col-md-3 col-lg-2">
                <div class="list-group">
                    <a href="#dashboard" class="list-group-item list-group-item-action active" onclick="showSection('dashboard')">
                        <i class="fas fa-tachometer-alt me-2"></i>儀表板
                    </a>
                    <a href="#employees" class="list-group-item list-group-item-action" onclick="showSection('employees')">
                        <i class="fas fa-users me-2"></i>員工管理
                    </a>
                    <a href="#attendance" class="list-group-item list-group-item-action" onclick="showSection('attendance')">
                        <i class="fas fa-clock me-2"></i>出勤管理
                    </a>
                    <a href="#revenue" class="list-group-item list-group-item-action" onclick="showSection('revenue')">
                        <i class="fas fa-chart-line me-2"></i>營收分析
                    </a>
                    <a href="#inventory" class="list-group-item list-group-item-action" onclick="showSection('inventory')">
                        <i class="fas fa-boxes me-2"></i>庫存管理
                    </a>
                    <a href="#maintenance" class="list-group-item list-group-item-action" onclick="showSection('maintenance')">
                        <i class="fas fa-tools me-2"></i>維修申請
                    </a>
                    <a href="#promotions" class="list-group-item list-group-item-action" onclick="showSection('promotions')">
                        <i class="fas fa-vote-yea me-2"></i>升遷投票
                    </a>
                    <a href="#reports" class="list-group-item list-group-item-action" onclick="showSection('reports')">
                        <i class="fas fa-chart-bar me-2"></i>報表系統
                    </a>
                    <a href="#settings" class="list-group-item list-group-item-action" onclick="showSection('settings')">
                        <i class="fas fa-cog me-2"></i>系統設定
                    </a>
                </div>
            </div>

            <!-- 主要內容 -->
            <div class="col-md-9 col-lg-10">
                <!-- 儀表板 -->
                <div id="dashboard-section" class="content-section">
                    <h2><i class="fas fa-tachometer-alt me-2"></i>管理員儀表板</h2>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="total-employees">--</h4>
                                            <p class="mb-0">總員工數</p>
                                        </div>
                                        <i class="fas fa-users fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="today-attendance">--</h4>
                                            <p class="mb-0">今日出勤</p>
                                        </div>
                                        <i class="fas fa-clock fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="month-revenue">--</h4>
                                            <p class="mb-0">本月營收</p>
                                        </div>
                                        <i class="fas fa-dollar-sign fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h4 id="pending-approvals">--</h4>
                                            <p class="mb-0">待審核</p>
                                        </div>
                                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5>營收趨勢圖</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="revenueChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>待處理事項</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush" id="pending-tasks">
                                        <li class="list-group-item">載入中...</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 員工管理 -->
                <div id="employees-section" class="content-section d-none">
                    <h2><i class="fas fa-users me-2"></i>員工管理</h2>
                    <div class="card">
                        <div class="card-header d-flex justify-content-between">
                            <h5>員工列表</h5>
                            <button class="btn btn-primary" onclick="addEmployee()">
                                <i class="fas fa-plus me-1"></i>新增員工
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>員工編號</th>
                                            <th>姓名</th>
                                            <th>職位</th>
                                            <th>部門</th>
                                            <th>狀態</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="employees-table">
                                        <tr>
                                            <td colspan="6" class="text-center">載入中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 其他內容區塊... -->
                <div id="attendance-section" class="content-section d-none">
                    <h2><i class="fas fa-clock me-2"></i>出勤管理</h2>
                    <p>出勤管理功能開發中...</p>
                </div>

                <div id="revenue-section" class="content-section d-none">
                    <h2><i class="fas fa-chart-line me-2"></i>營收分析</h2>
                    <p>營收分析功能開發中...</p>
                </div>

                <div id="inventory-section" class="content-section d-none">
                    <h2><i class="fas fa-boxes me-2"></i>庫存管理</h2>
                    <p>庫存管理功能開發中...</p>
                </div>

                <div id="maintenance-section" class="content-section d-none">
                    <h2><i class="fas fa-tools me-2"></i>維修申請</h2>
                    <p>維修申請功能開發中...</p>
                </div>

                <div id="promotions-section" class="content-section d-none">
                    <h2><i class="fas fa-vote-yea me-2"></i>升遷投票</h2>
                    <p>升遷投票功能開發中...</p>
                </div>

                <div id="reports-section" class="content-section d-none">
                    <h2><i class="fas fa-chart-bar me-2"></i>報表系統</h2>
                    <p>報表系統功能開發中...</p>
                </div>

                <div id="settings-section" class="content-section d-none">
                    <h2><i class="fas fa-cog me-2"></i>系統設定</h2>
                    <p>系統設定功能開發中...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // 檢查是否為管理員
        function checkAdminAuth() {
            const token = localStorage.getItem('jwt_token');
            const user = JSON.parse(localStorage.getItem('user_data') || '{}');
            
            if (!token || !user || !['admin', 'manager'].includes(user.role)) {
                alert('您沒有權限訪問此頁面');
                window.location.href = '/login.html';
                return false;
            }
            
            document.getElementById('admin-name').textContent = user.name;
            return true;
        }

        // 顯示指定區塊
        function showSection(sectionName) {
            // 隱藏所有內容區塊
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('d-none');
            });
            
            // 移除所有側邊欄活動狀態
            document.querySelectorAll('.list-group-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 顯示指定區塊
            document.getElementById(sectionName + '-section').classList.remove('d-none');
            
            // 設定側邊欄活動狀態
            document.querySelector(`[onclick="showSection('${sectionName}')"]`).classList.add('active');
            
            // 載入對應數據
            if (sectionName === 'dashboard') loadDashboard();
            if (sectionName === 'employees') loadEmployees();
        }

        // 載入儀表板數據
        async function loadDashboard() {
            const token = localStorage.getItem('jwt_token');
            
            try {
                const response = await fetch('/api/dashboard/stats', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('total-employees').textContent = stats.employees?.total || 0;
                    document.getElementById('today-attendance').textContent = stats.attendance?.today || 0;
                    document.getElementById('month-revenue').textContent = '$' + (stats.revenue?.month || 0);
                    document.getElementById('pending-approvals').textContent = stats.pending?.approvals || 0;
                }
            } catch (error) {
                console.error('載入儀表板數據失敗:', error);
            }
        }

        // 載入員工列表
        async function loadEmployees() {
            const token = localStorage.getItem('jwt_token');
            
            try {
                const response = await fetch('/api/employees', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const employees = result.data || [];
                    
                    const tbody = document.getElementById('employees-table');
                    tbody.innerHTML = employees.map(emp => `
                        <tr>
                            <td>${emp.employee_id || '--'}</td>
                            <td>${emp.name}</td>
                            <td>${emp.role}</td>
                            <td>${emp.department_name || '--'}</td>
                            <td>
                                <span class="badge ${emp.is_active ? 'bg-success' : 'bg-secondary'}">
                                    ${emp.is_active ? '在職' : '離職'}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="editEmployee(${emp.id})">編輯</button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteEmployee(${emp.id})">刪除</button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('載入員工列表失敗:', error);
                document.getElementById('employees-table').innerHTML = 
                    '<tr><td colspan="6" class="text-center text-danger">載入失敗</td></tr>';
            }
        }

        // 登出
        function logout() {
            localStorage.removeItem('jwt_token');
            localStorage.removeItem('user_data');
            window.location.href = '/login.html';
        }

        // 新增員工
        function addEmployee() {
            alert('新增員工功能開發中...');
        }

        // 編輯員工
        function editEmployee(id) {
            alert(`編輯員工 ID: ${id} 功能開發中...`);
        }

        // 刪除員工
        function deleteEmployee(id) {
            if (confirm('確定要刪除此員工嗎？')) {
                alert(`刪除員工 ID: ${id} 功能開發中...`);
            }
        }

        // 頁面載入時執行
        document.addEventListener('DOMContentLoaded', function() {
            if (checkAdminAuth()) {
                loadDashboard();
            }
        });
    </script>
</body>
</html>